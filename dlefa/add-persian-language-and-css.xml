<?xml version="1.0" encoding="utf-8"?>
<dleplugin>
	<name>Add Persian Language and CSS</name>
	<description>اضافه کردن فایل های css نسخه فارسی و راست چین سازی</description>
	<icon></icon>
	<version>1.0</version>
	<dleversion>13.0</dleversion>
	<versioncompare>greater</versioncompare>
	<upgradeurl>https://dlefa.ir/updates/dlefa_css.xml</upgradeurl>
	<filedelete>1</filedelete>
	<mysqlinstall><![CDATA[]]></mysqlinstall>
	<mysqlupgrade><![CDATA[]]></mysqlupgrade>
	<mysqlenable><![CDATA[]]></mysqlenable>
	<mysqldisable><![CDATA[]]></mysqldisable>
	<mysqldelete><![CDATA[]]></mysqldelete>
	<file name="engine/inc/include/functions.inc.php">
		<operation action="replace">
			<searchcode><![CDATA[		$default_array = array (
			'engine/skins/javascripts/application.js',
		);]]></searchcode>
			<replacecode><![CDATA[		if (isset( $_COOKIE['selected_language'] )) {
			
			if ($_COOKIE['selected_language'] == 'Farsi'){
				$default_array = array (
					'engine/skins/javascripts/application_fa.js',
				);
			}else{	
				$default_array = array (
					'engine/skins/javascripts/application.js',
				);
			}
			
			
		}else{
			
			if ($config['langs'] == 'Farsi'){
				$default_array = array (
					'engine/skins/javascripts/application_fa.js',
				);
			}else{	
				$default_array = array (
					'engine/skins/javascripts/application.js',
				);
			}
			
		}]]></replacecode>
		</operation>
		<operation action="replace">
			<searchcode><![CDATA[function build_css($css) {
	global $config;

	$default_array = array (
		'engine/skins/fonts/fontawesome/styles.min.css',
		'engine/skins/stylesheets/application.css'
	);]]></searchcode>
			<replacecode><![CDATA[function build_css($css) {
	global $config, $db;

	if (isset( $_COOKIE['selected_language'] )) {
		
		if ($_COOKIE['selected_language'] == 'Farsi'){
			$default_array = array (
				'engine/skins/fonts/fontawesome/styles.min.css',
				'engine/skins/stylesheets/application_fa.css'
			);
          	$row = $db->super_query( "SELECT id FROM " . PREFIX . "_plugins WHERE name='Persian DataLife Engine'" );
			$db->query( "UPDATE " . PREFIX . "_plugins SET active='1' WHERE id='{$row['id']}'" );
          	$db->query( "UPDATE " . PREFIX . "_plugins_files SET active='1' WHERE plugin_id='{$row['id']}'" );
          	clear_all_caches();
        }else{	
			$default_array = array (
				'engine/skins/fonts/fontawesome/styles.min.css',
				'engine/skins/stylesheets/application.css'
			);
          	$row = $db->super_query( "SELECT id FROM " . PREFIX . "_plugins WHERE name='Persian DataLife Engine'" );
			$db->query( "UPDATE " . PREFIX . "_plugins SET active='0' WHERE id='{$row['id']}'" );
          	$db->query( "UPDATE " . PREFIX . "_plugins_files SET active='0' WHERE plugin_id='{$row['id']}'" );
          	clear_all_caches();
        }		
	}else{	
		if ($config['langs'] == 'Farsi'){
			$default_array = array (
				'engine/skins/fonts/fontawesome/styles.min.css',
				'engine/skins/stylesheets/application_fa.css'
			);
          	$row = $db->super_query( "SELECT id FROM " . PREFIX . "_plugins WHERE name='Persian DataLife Engine'" );
			$db->query( "UPDATE " . PREFIX . "_plugins SET active='1' WHERE id='{$row['id']}'" );
          	$db->query( "UPDATE " . PREFIX . "_plugins_files SET active='1' WHERE plugin_id='{$row['id']}'" );
          	clear_all_caches();
		}else{	
			$default_array = array (
				'engine/skins/fonts/fontawesome/styles.min.css',
				'engine/skins/stylesheets/application.css'
			);
          	$row = $db->super_query( "SELECT id FROM " . PREFIX . "_plugins WHERE name='Persian DataLife Engine'" );
			$db->query( "UPDATE " . PREFIX . "_plugins SET active='0' WHERE id='{$row['id']}'" );
          	$db->query( "UPDATE " . PREFIX . "_plugins_files SET active='0' WHERE plugin_id='{$row['id']}'" );
          	clear_all_caches();
        }		
	}]]></replacecode>
		</operation>
	</file>
	<file name="engine/classes/antivirus.class.php">
		<operation action="after">
			<searchcode><![CDATA[var $good_files       = array(]]></searchcode>
			<replacecode><![CDATA["./engine/classes/jdate.class.php",
"./engine/ajax/calendar_fa.php",
"./engine/ajax/updates_fa.php",
"./engine/modules/calendar_fa.php",]]></replacecode>
		</operation>
	</file>
</dleplugin>